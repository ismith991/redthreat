<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evidence Engine — Browser History Log</title>

  <!-- FontAwesome (Icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

  <!-- Export Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg:#0a0a0a;
      --panel:#1e1e1e;
      --card:#1c1c1c;
      --text:#e0e0e0;
      --muted:#b7b7b7;
      --line:#2a2a2a;
      --red:#d32f2f;

      /* Chrome History (Desktop-like) */
      --chrome-bg:#ffffff;
      --chrome-ink:#1f1f1f;
      --chrome-sub:#6b6b6b;
      --chrome-rule:#e7e7e7;
      --chrome-hover:#f6f6f6;
      --chrome-blue:#1a73e8;
      --chrome-chip:#f1f3f4;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      overflow:hidden;
    }

    /* Split Screen */
    .app{ display:flex; height:100vh; width:100vw; }

    /* Left Panel */
    .control{
      width:30%;
      min-width:320px;
      background:var(--panel);
      border-right:1px solid var(--line);
      padding:22px 18px;
      overflow:auto;
    }

    .cc-title{
      display:flex;
      align-items:center;
      gap:10px;
      margin:0 0 14px 0;
      font-family:"Courier Prime", monospace;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:14px;
    }
    .cc-title i{ color:var(--red); }

    .cc-card{
      background:rgba(255,255,255,.02);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      margin-bottom:14px;
      box-shadow:0 10px 20px rgba(0,0,0,.25);
    }

    .label{
      display:block;
      color:var(--muted);
      font-size:12px;
      margin-bottom:6px;
      letter-spacing:.02em;
    }

    .input, .select{
      width:100%;
      border-radius:12px;
      border:1px solid #303030;
      background:#121212;
      color:var(--text);
      padding:12px 12px;
      outline:none;
      font-size:14px;
      font-family:Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    }
    .input:focus, .select:focus{
      border-color:var(--red);
      box-shadow:0 0 0 3px rgba(211,47,47,.18);
    }

    .row{ display:flex; gap:10px; }
    .row > *{ flex:1; }

    .btn{
      width:100%;
      border:none;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(211,47,47,.9), rgba(211,47,47,.75));
      color:#fff;
      padding:12px 14px;
      font-weight:700;
      cursor:pointer;
      letter-spacing:.02em;
    }
    .btn:hover{ filter:brightness(1.05); }
    .btn:active{ transform:translateY(1px); }

    .ghost{
      width:100%;
      border-radius:12px;
      background:transparent;
      border:1px solid #3a3a3a;
      color:var(--text);
      padding:12px 14px;
      font-weight:600;
      cursor:pointer;
    }
    .ghost:hover{ border-color:var(--red); color:#fff; }

    .tiny{
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
      margin:10px 0 0 0;
    }

    /* Right Panel */
    .preview-wrap{
      width:70%;
      overflow:auto;
      padding:28px;
    }

    /* Desktop “Chrome History” canvas */
    .chrome{
      width: 1050px;
      background:var(--chrome-bg);
      color:var(--chrome-ink);
      border:1px solid #d6d6d6;
      border-radius:14px;
      box-shadow:0 18px 45px rgba(0,0,0,.55);
      overflow:hidden;
      font-family:Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    }

    .chrome-topbar{
      height:56px;
      display:flex;
      align-items:center;
      padding:0 16px;
      border-bottom:1px solid var(--chrome-rule);
      gap:12px;
      background:#fff;
    }
    .chrome-topbar .dot{
      width:10px; height:10px; border-radius:50%;
      background:#d9d9d9;
    }
    .chrome-title{
      font-weight:600;
      font-size:14px;
      margin-left:6px;
      color:#202124;
    }
    .chrome-breadcrumb{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:10px;
      color:#5f6368;
      font-size:13px;
    }
    .chrome-breadcrumb .chip{
      background:var(--chrome-chip);
      border:1px solid #e1e3e6;
      padding:6px 10px;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .chrome-breadcrumb i{ color:#5f6368; }

    .chrome-body{
      padding:16px 0 10px 0;
    }

    .group{
      padding:0 18px 6px 18px;
    }

    .group-title{
      font-size:13px;
      font-weight:700;
      color:#3c4043;
      margin:14px 0 8px 0;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .group-title::before{
      content:"";
      height:1px;
      flex:1;
      background:var(--chrome-rule);
      opacity:.9;
      order:2;
      margin-left:10px;
    }
    .group-title span{ order:1; }

    .list{
      border-top:1px solid var(--chrome-rule);
      border-bottom:1px solid var(--chrome-rule);
    }

    .item{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 8px;
      border-top:1px solid var(--chrome-rule);
    }
    .item:first-child{ border-top:none; }
    .item:hover{ background:var(--chrome-hover); }

    .time{
      width:88px;
      color:#5f6368;
      font-size:12px;
      flex:0 0 auto;
    }

    .fav{
      width:28px;
      height:28px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid #e6e6e6;
      background:#fff;
      flex:0 0 auto;
    }
    .fav i{ font-size:14px; }
    .fav .google{ color:var(--chrome-blue); }
    .fav .globe{ color:#5f6368; }

    .content{
      min-width:0;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .title{
      font-weight:700;
      font-size:13px;
      color:#202124;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .url{
      font-size:12px;
      color:#6b6b6b;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .menu{
      width:32px;
      height:32px;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#5f6368;
      flex:0 0 auto;
    }
    .menu i{ font-size:14px; }
    .menu:hover{
      background:#ededed;
    }

    .empty{
      margin:14px 18px 0 18px;
      padding:14px;
      border:1px dashed #d9d9d9;
      border-radius:10px;
      color:#6b6b6b;
      font-size:13px;
      display:none;
    }
    .empty.show{ display:block; }

    /* Responsive */
    @media (max-width: 1180px){
      .chrome{ width:100%; }
    }
    @media (max-width: 860px){
      body{ overflow:auto; }
      .app{ flex-direction:column; height:auto; }
      .control, .preview-wrap{ width:100%; }
      .preview-wrap{ padding:16px; }
    }

    /* Scrollbars */
    .control::-webkit-scrollbar, .preview-wrap::-webkit-scrollbar { width:10px; }
    .control::-webkit-scrollbar-thumb, .preview-wrap::-webkit-scrollbar-thumb{
      background:#2a2a2a;
      border-radius:10px;
      border:2px solid transparent;
      background-clip:content-box;
    }
    .control::-webkit-scrollbar-thumb:hover, .preview-wrap::-webkit-scrollbar-thumb:hover{
      background:#3a3a3a;
      background-clip:content-box;
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- LEFT: CONTROL CENTER -->
    <aside class="control">
      <h2 class="cc-title"><i class="fa-solid fa-clock-rotate-left"></i> Cyber &amp; Telecom — Browser History</h2>

      <div class="cc-card">
        <label class="label" for="groupName">Date Group Name</label>
        <input id="groupName" class="input" type="text" placeholder="Today / Yesterday / 2025-12-28" value="Today" />

        <div style="height:10px"></div>

        <button id="createGroupBtn" class="btn">
          <i class="fa-solid fa-folder-plus" style="margin-right:8px"></i>
          Create / Select Group
        </button>

        <p class="tiny">
          Create a group like <b>Today</b> or <b>Yesterday</b>, then add entries into that group.
        </p>
      </div>

      <div class="cc-card">
        <label class="label">Add Entry</label>

        <div class="row">
          <div>
            <label class="label" for="time">Time</label>
            <input id="time" class="input" type="text" placeholder="10:42 PM" value="10:42 PM" />
          </div>
          <div>
            <label class="label" for="icon">Icon</label>
            <select id="icon" class="select">
              <option value="google" selected>Google (G)</option>
              <option value="globe">Globe</option>
            </select>
          </div>
        </div>

        <div style="height:10px"></div>

        <label class="label" for="title">Page Title</label>
        <input id="title" class="input" type="text" placeholder="Example: Bank login — Secure" value="Google Search" />

        <div style="height:10px"></div>

        <label class="label" for="url">URL</label>
        <input id="url" class="input" type="text" placeholder="https://example.com/path" value="https://www.google.com/" />

        <div style="height:12px"></div>

        <div class="row">
          <button id="addBtn" class="btn"><i class="fa-solid fa-plus" style="margin-right:8px"></i>Add Entry</button>
          <button id="clearBtn" class="ghost"><i class="fa-solid fa-trash" style="margin-right:8px"></i>Clear All</button>
        </div>

        <p class="tiny">Entries are grouped by Date Group name, like Chrome History.</p>
      </div>

      <div class="cc-card">
        <div class="row">
          <div>
            <label class="label" for="exportType">Export Type</label>
            <select id="exportType" class="select">
              <option value="jpg">High-res JPG</option>
              <option value="pdf">PDF</option>
            </select>
          </div>
          <div>
            <label class="label" for="exportScale">Quality</label>
            <select id="exportScale" class="select">
              <option value="2">Standard</option>
              <option value="3" selected>High</option>
              <option value="4">Ultra</option>
            </select>
          </div>
        </div>

        <div style="height:10px"></div>

        <button id="downloadBtn" class="btn">
          <i class="fa-solid fa-download" style="margin-right:8px"></i>
          Download Evidence
        </button>

        <p class="tiny">Exports the browser history view (right panel) as evidence.</p>
      </div>
    </aside>

    <!-- RIGHT: LIVE PREVIEW -->
    <main class="preview-wrap">
      <section id="captureArea" class="chrome" aria-label="Chrome History Desktop View">
        <div class="chrome-topbar">
          <div class="dot"></div><div class="dot"></div><div class="dot"></div>
          <div class="chrome-title">History</div>
          <div class="chrome-breadcrumb">
            <div class="chip"><i class="fa-solid fa-magnifying-glass"></i><span>Search history</span></div>
            <div class="chip"><i class="fa-solid fa-trash"></i><span>Clear browsing data</span></div>
          </div>
        </div>

        <div class="chrome-body" id="historyRoot">
          <!-- groups render here -->
        </div>

        <div id="emptyState" class="empty">
          No entries yet. Create a date group and add a history entry.
        </div>
      </section>
    </main>

  </div>

  <script>
    // ------- State -------
    const groups = new Map(); // groupName -> {sectionEl, listEl}
    let activeGroup = "Today";

    // ------- Elements -------
    const groupNameInput = document.getElementById('groupName');
    const createGroupBtn = document.getElementById('createGroupBtn');

    const timeInput = document.getElementById('time');
    const iconSel = document.getElementById('icon');
    const titleInput = document.getElementById('title');
    const urlInput = document.getElementById('url');
    const addBtn = document.getElementById('addBtn');
    const clearBtn = document.getElementById('clearBtn');

    const historyRoot = document.getElementById('historyRoot');
    const emptyState = document.getElementById('emptyState');

    function normalizeGroupName(s){
      return (s || "").trim();
    }

    function setEmptyState(){
      const hasAny = groups.size > 0 && Array.from(groups.values()).some(g => g.listEl.children.length > 0);
      emptyState.classList.toggle('show', !hasAny);
    }

    // ------- Create/select group -------
    function ensureGroup(name){
      const key = normalizeGroupName(name);
      if(!key) return null;

      if(groups.has(key)) return groups.get(key);

      const section = document.createElement('div');
      section.className = 'group';
      section.setAttribute('data-group', key);

      const title = document.createElement('div');
      title.className = 'group-title';
      title.innerHTML = `<span>${escapeHtml(key)}</span>`;
      section.appendChild(title);

      const list = document.createElement('div');
      list.className = 'list';
      section.appendChild(list);

      // Insert at top (Chrome shows recent groups first; but this is manual)
      historyRoot.insertBefore(section, historyRoot.firstChild);

      const obj = { sectionEl: section, listEl: list };
      groups.set(key, obj);
      return obj;
    }

    function selectGroup(name){
      const key = normalizeGroupName(name);
      if(!key) return;
      ensureGroup(key);
      activeGroup = key;

      // Small UX: reflect selection in input
      groupNameInput.value = key;

      // Visually hint active group (subtle)
      for(const [g, obj] of groups.entries()){
        obj.sectionEl.style.outline = (g === activeGroup) ? '2px solid rgba(26,115,232,.35)' : 'none';
        obj.sectionEl.style.outlineOffset = '6px';
        obj.sectionEl.style.borderRadius = '10px';
      }
    }

    createGroupBtn.addEventListener('click', () => {
      selectGroup(groupNameInput.value || "Today");
      setEmptyState();
    });

    // ------- Add entry -------
    function iconHtml(kind){
      if(kind === 'google') return `<i class="fa-brands fa-google google"></i>`;
      return `<i class="fa-solid fa-globe globe"></i>`;
    }

    function addEntry(){
      const group = ensureGroup(activeGroup);
      if(!group) return;

      const t = (timeInput.value || "").trim();
      const title = (titleInput.value || "").trim();
      const url = (urlInput.value || "").trim();
      if(!t || !title || !url) return;

      const item = document.createElement('div');
      item.className = 'item';
      item.innerHTML = `
        <div class="time">${escapeHtml(t)}</div>
        <div class="fav">${iconHtml(iconSel.value)}</div>
        <div class="content">
          <div class="title">${escapeHtml(title)}</div>
          <div class="url">${escapeHtml(url)}</div>
        </div>
        <div class="menu" title="More"><i class="fa-solid fa-ellipsis-vertical"></i></div>
      `;

      // Insert at top within the group (recent first)
      group.listEl.insertBefore(item, group.listEl.firstChild);

      // Clear fields lightly
      titleInput.value = "";
      urlInput.value = "";
      titleInput.focus();

      setEmptyState();
    }

    addBtn.addEventListener('click', addEntry);
    [timeInput, titleInput, urlInput].forEach(el => {
      el.addEventListener('keydown', (e) => {
        if(e.key === 'Enter'){
          e.preventDefault();
          addEntry();
        }
      });
    });

    // ------- Clear all -------
    clearBtn.addEventListener('click', () => {
      groups.clear();
      historyRoot.innerHTML = "";
      activeGroup = "Today";
      selectGroup("Today"); // recreates with outline (empty)
      // remove empty group if no entries
      const g = groups.get("Today");
      if(g) g.sectionEl.remove();
      groups.delete("Today");
      setEmptyState();
    });

    // ------- Helpers -------
    function escapeHtml(str){
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // ------- Seed with default group + a couple entries -------
    selectGroup("Today");
    ensureGroup("Today");
    addEntrySeed("Today", "10:42 PM", "google", "Google Search", "https://www.google.com/");
    addEntrySeed("Today", "10:18 PM", "globe", "Secure Login — Example Bank", "https://secure.examplebank.com/login");
    selectGroup("Yesterday");
    ensureGroup("Yesterday");
    addEntrySeed("Yesterday", "11:02 PM", "globe", "How to delete browser history", "https://support.example.com/history");

    // Back to Today as active
    selectGroup("Today");
    setEmptyState();

    function addEntrySeed(groupName, time, iconKind, title, url){
      const g = ensureGroup(groupName);
      const item = document.createElement('div');
      item.className = 'item';
      item.innerHTML = `
        <div class="time">${escapeHtml(time)}</div>
        <div class="fav">${iconHtml(iconKind)}</div>
        <div class="content">
          <div class="title">${escapeHtml(title)}</div>
          <div class="url">${escapeHtml(url)}</div>
        </div>
        <div class="menu" title="More"><i class="fa-solid fa-ellipsis-vertical"></i></div>
      `;
      g.listEl.appendChild(item); // seed in chronological order
    }

    // ------- Export -------
    const downloadBtn = document.getElementById('downloadBtn');
    const exportType = document.getElementById('exportType');
    const exportScale = document.getElementById('exportScale');
    const captureArea = document.getElementById('captureArea');

    function pad(n){ return String(n).padStart(2,'0'); }
    function fileStamp(){
      const d = new Date();
      return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}_${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
    }

    async function exportEvidence(){
      const type = exportType.value;
      const scale = Number(exportScale.value || 3);

      const canvas = await html2canvas(captureArea, {
        backgroundColor: "#ffffff",
        scale,
        useCORS: true
      });

      const base = `browser_history_${fileStamp()}`;

      if(type === 'jpg'){
        const url = canvas.toDataURL('image/jpeg', 0.95);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${base}.jpg`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        return;
      }

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation:'l', unit:'pt', format:'a4' });

      const imgData = canvas.toDataURL('image/jpeg', 0.95);
      const pageW = pdf.internal.pageSize.getWidth();
      const pageH = pdf.internal.pageSize.getHeight();
      const margin = 22;

      const imgW = canvas.width;
      const imgH = canvas.height;

      const maxW = pageW - margin * 2;
      const maxH = pageH - margin * 2;

      const ratio = Math.min(maxW / imgW, maxH / imgH);
      const drawW = imgW * ratio;
      const drawH = imgH * ratio;

      const x = (pageW - drawW) / 2;
      const y = (pageH - drawH) / 2;

      pdf.addImage(imgData, 'JPEG', x, y, drawW, drawH);
      pdf.save(`${base}.pdf`);
    }

    downloadBtn.addEventListener('click', exportEvidence);
  </script>
</body>
</html>
